<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Structura · 交互式架构图生成器</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- 引入 SortableJS 库 -->
    <script src="https://cdn.bootcdn.net/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <!-- 引入 Marked.js 用于解析Markdown -->
    <script src="https://cdn.bootcdn.net/ajax/libs/marked/12.0.2/marked.min.js"></script>
    <!-- 引入 Remix Icon 图标库 -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/remixicon/4.2.0/remixicon.min.css">
    <!-- 基础样式 -->
    <link rel="stylesheet" href="themes/base.css">
    <!-- 主题样式 - 动态加载 -->
    <link id="theme-css" rel="stylesheet" href="themes/default.css">
</head>
<body>
    <header class="main-header">
        <h1>
            <img src="/favicon.svg" alt="Structura Logo" class="logo" style="height: 1.5em; vertical-align: middle; margin-right: 8px;">
            Structura · 交互式架构图生成器
        </h1>
        <div class="header-actions">
            <a href="https://github.com/Simuoss/Structura" target="_blank" class="github-link" title="查看GitHub仓库">
                <i class="ri-github-fill"></i>
            </a>
            <div class="theme-selector">
                <label for="theme-select">主题:</label>
                <select id="theme-select">
                    <!-- 主题选项将通过JavaScript动态生成 -->
                </select>
            </div>
        </div>
    </header>
    <main class="main-container">
        <div class="panel panel-controls">
            <h2>输入Structura代码</h2>
            <textarea id="input-textarea" placeholder="使用 # 定义层级, - 定义项目..."></textarea>
            
            
            
            <h2>操作</h2>
            <button class="button" id="generate-btn">生成 / 更新图表</button>
            <button class="button" id="export-btn">导出HTML文件</button>
            <button class="button" id="reset-settings-btn" style="background-color: #f44336; color: white;">重置设置</button>

            <h2>设置</h2>
            <div style="margin-bottom: 16px;">
                <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; margin-bottom: 8px;">
                    <input type="checkbox" id="show-structure-toggles" checked>
                    显示结构层布局按钮
                </label>
                <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; margin-bottom: 8px;">
                    <input type="checkbox" id="hide-outlines">
                    不显示轮廓线
                </label>
                <div style="margin-bottom: 8px;">
                    <label style="display: block; font-size: 14px; margin-bottom: 4px;">字体和字号设置:</label>
                    <div style="display: flex; gap: 8px;">
                        <select id="font-family" style="flex: 2; padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
                            <!-- 字体选项将通过JavaScript动态生成 -->
                        </select>
                        <select id="font-size" style="flex: 1; padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="12">12px</option>
                            <option value="14" selected>14px</option>
                            <option value="16">16px</option>
                            <option value="18">18px</option>
                            <option value="20">20px</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin-bottom: 8px;">
                    <label style="display: block; font-size: 14px; margin-bottom: 4px;">全局边距倍数:</label>
                    <input type="range" id="global-spacing" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
                    <div style="text-align: center; font-size: 12px; color: #666; margin-top: 2px;">
                        <span id="global-spacing-value">1.0</span>x
                    </div>
                </div>
                
                <div style="margin-bottom: 8px;">
                    <label style="display: block; font-size: 14px; margin-bottom: 4px;">分项倍数设置:</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
                        <div>
                            <label style="display: block; margin-bottom: 2px;">内边距:</label>
                            <input type="range" id="padding-multiplier" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
                            <div style="text-align: center; color: #666;">
                                <span id="padding-value">1.0</span>x
                            </div>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 2px;">外边距:</label>
                            <input type="range" id="margin-multiplier" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
                            <div style="text-align: center; color: #666;">
                                <span id="margin-value">1.0</span>x
                            </div>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 2px;">边框:</label>
                            <input type="range" id="border-multiplier" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
                            <div style="text-align: center; color: #666;">
                                <span id="border-value">1.0</span>x
                            </div>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 2px;">圆角:</label>
                            <input type="range" id="border-radius-multiplier" min="0" max="3" step="0.1" value="1" style="width: 100%;">
                            <div style="text-align: center; color: #666;">
                                <span id="border-radius-value">1.0</span>x
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h2>📖 语法指南</h2>
            <div class="syntax-guide">
                <p style="margin-bottom: 12px; font-style: italic;">Structura 的语法旨在简单直观。</p>
                
                <details style="margin-bottom: 8px;" open>
                    <summary>基础结构语法</summary>
                    <div>
                        <p class="syntax-description">只有两种基础语法：<code>#</code> 和 <code>-</code>。掌握这两种就够应付 <strong>80%</strong> 以上场景了！</p>
                        <p><code># 标题</code> - 创建一个顶级模块</p>
                        <p><code>## 标题</code>, <code>### 标题</code>... - 创建一个子模块（最多10级），嵌套进离自己最近的前一个母块里。可以循环嵌套</p>
                        <p><code>##</code> (无标题) - 创建一个不可见的隐形容器，可以作为一个不可见的母级使用，用于实现"一横两纵"这种复杂排布</p>
                        <p><code>- 文本项</code> - 在模块内创建一个简单的文本项</p>
                    </div>
                </details>
                
                <details>
                    <summary>侧边栏语法</summary>
                    <div>
                        <p class="syntax-description">有时候，日志模块需要显示在一侧，贯穿其他模块。所以我们引入了 <code>|</code> 语法。<br>其实用不带标题的 <code>##</code> 结构块也可以实现这个效果，但是侧边块语法更加方便，也比 <code>##</code> 结构块更窄。</p>
                        <p><code>##| 标题</code> - 创建左侧边栏块</p>
                        <p><code>## 标题 |</code> - 创建右侧边栏块</p>
                    </div>
                </details>
                
                <details>
                    <summary>块属性语法</summary>
                    <div>
                        <p class="syntax-description">
                            • 有时候我们想直接在代码里控制块是横排还是纵排<br>
                            • 有时候我们想修改块的颜色<br>
                            • 有时候我们想给块起个名字（用来拉箭头）<br>
                            • 所以我们引入了 <code>:</code> 语法和 <code>{}</code> 语法
                        </p>
                        <p><code>## 标题 :my-id</code> - 为块设置自定义ID</p>
                        <p><code>## 标题 r:</code> - 应用横向布局</p>
                        <p><code>## 标题 c:</code> - 应用纵向布局</p>
                        <p><code>## 标题 c:my-id</code> - 同时设置ID并应用纵向布局</p>
                        <p><code>## 标题 {style="background-color: red;"}</code> - 为块应用自定义CSS样式。这里填写的style属性会直接添加到块的style属性中</p>
                        <p><code>## 标题 c:my-id {style="background-color: red;"}</code> - 同时应用上面的所有功能</p>
                        <p><code>## 标题 {id=my-id, layout=c, style="background-color: red;"}</code> - 其实类似 <code>c:my-id</code> 这种语法是 <code>{}</code> 语法的语法糖。所以，我们其实可以直接在 <code>{}</code> 语法中完成所有事情</p>
                    </div>
                </details>
                
                <details>
                    <summary>内容块语法</summary>
                    <div>
                        <p class="syntax-description">有没有可能，在内容块里面写Markdown呢？<br>我们引入了 <code>```</code> 语法。另外，为了方便写注释，我们还引入了 <code>//</code> 语法。</p>
                        <p><code>```文本块 ```</code> - 创建可以跨行的纯文本块</p>
                        <p><code>```md # 标题 ```</code> - 创建跨越多行的Markdown渲染内容块</p>
                        <p><code>//</code> - 添加注释（不在输出中显示）</p>
                    </div>
                </details>
            </div>

        </div>
        <div class="panel panel-preview">
            <h2>交互式预览</h2>
            <div id="diagram-output"></div>
        </div>
        <div class="panel panel-code">
            <h2>对应HTML代码</h2>
            <pre id="code-preview"><code>点击“生成”按钮以显示代码...</code></pre>
        </div>
    </main>

    <!-- 引入模块化脚本 -->
    <script src="core/config.js"></script>
    <script src="core/ast.js"></script>
    <script src="core/render.js"></script>
    <script src="core/main.js"></script>
    
    <script>
        // 初始化应用
        document.addEventListener('DOMContentLoaded', async () => {
            // 创建管理器实例
            const astParser = new ASTParser();
            const renderer = new Renderer();
            const configManager = new ConfigManager();
            const mainManager = new MainManager();
            
            // 设置依赖关系
            mainManager.setDependencies(astParser, renderer, configManager);
            
            // 初始化各个管理器
            await configManager.initialize();
            await renderer.initialize();
            await mainManager.initialize();
            
            // 首次进入网页自动触发一次渲染
            setTimeout(() => {
                mainManager.generateAndRender();
            }, 100);
        });
    </script>
</body>
</html>

